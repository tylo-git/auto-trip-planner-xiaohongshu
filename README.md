# TRLP (The Real Lazy Person) 🛌✈️

> **"Input Once, Plan Everything."**
> 基于 **Multi-Agent (AutoGen)**、**GraphRAG (Neo4j)** 和 **MCP** 的下一代智能旅行规划系统。

TRLP 是一个全栈 AI 旅行助手，它不只是简单地调用 LLM，而是通过编排多个专家智能体，模拟人类规划师的完整工作流：从全网搜集信息、构建本地知识图谱、推理最佳路线，到撰写深度游玩指南和绘制可视化图表。

## 项目介绍视频
<!-- 方式1：直接链接（点击跳转查看） -->
[点击查看项目介绍视频](assets/videos/intro.mp4)

<!-- 方式2：视频预览（部分浏览器/GitHub 界面支持直接播放） -->
<video width="800" height="450" controls>
  <source src="https://raw.githubusercontent.com/tylo-git/auto-trip-planner-based-on-redbook/main/assets/videos/intro.mp4" type="video/mp4">
  你的浏览器不支持视频播放，请点击链接查看：<a href="assets/videos/intro.mp4">intro.mp4</a>
</video>

---

## 🌟 核心特性 (Key Features)

### 1. 🧠 双模式智能规划
*   **特种兵模式 (Special Forces)**: 极限时间管理，基于拓扑优化算法（不折返），计算真实通勤时间，适合硬核打卡。
*   **吃货模式 (Foodie)**: 以“饭点”为核心锚点，寻找苍蝇馆子与夜市，景点只是消食的借口。

### 2. 🕸️ 动态 GraphRAG (知识图谱增强)
*   **实时构建**: 每次规划前自动清洗数据库，基于检索到的数十篇笔记（小红书 + DeepSearch），利用 LLM 实时提取实体（Place, Food, Price）和关系构建 Neo4j 图谱。
*   **精准推理**: 基于图谱进行多跳查询（例如：“找一个离夜市最近且人均低于50元的酒店”），拒绝幻觉。

### 3. 📚 深度内容生成
*   **2000字深度指南**: 由专门的 **Writer Agent** 撰写，模拟《Condé Nast Traveler》杂志风格，包含城市侧写、每日深度复盘、避坑指南等，支持 **Markdown 下载**。
*   **可视化路线图**: 自动生成 **Graphviz** 拓扑结构图，清晰展示每日行程流向。
*   **精准预算**: **Budget Agent** 使用 Python Pandas 进行精确的分类汇总和可视化。

### 4. 🌐 混合检索 (Hybrid Search)
*   **MCP (Model Context Protocol)**: 标准化集成小红书数据。
*   **DeepSearch**: 集成 DuckDuckGo/Tavily，获取全网实时资讯（门票、开放时间）。
*   **智能 Fallback**: 当 API 不可用时，自动降级使用模拟数据或备用源，保证系统高可用。

---

## 🚀 快速开始 (Quick Start)

### 1. 环境准备
```bash
# 创建环境
conda create -n trlp python=3.11
conda activate trlp

# 安装依赖
pip install -r requirements.txt
```

### 2. 基础设施配置
本项目依赖 **Neo4j** 数据库。推荐使用 Docker 启动：
```bash
docker run -d --name neo4j -p 7474:7474 -p 7687:7687 -e NEO4J_AUTH=neo4j/password neo4j:latest
```

### 3. 环境变量
复制 `.env.example` 为 `.env` 并配置：
```ini
# LLM 配置
OPENAI_API_KEY=sk-...
OPENAI_BASE_URL=https://api.openai.com/v1 # 可选
GEMINI_API_KEY=... # 用于绘图 Agent (可选)

# Neo4j 配置
NEO4J_URI=bolt://localhost:7687
NEO4J_USER=neo4j
NEO4J_PASSWORD=password

# 搜索服务
MCP_XHS_ENDPOINT=http://localhost:8000 # 可选
DEEPSEARCH_API_KEY=... # 可选 (Tavily), 默认使用 DuckDuckGo (免费)
```

### 4. 运行系统
```bash
streamlit run src/app.py
```
访问浏览器 `http://localhost:8501` 即可开始使用。

---

## 🏗️ 系统架构 (Architecture)
![框架路线图](assets/images/roadmap.png)

## 📂 项目结构

```text
src/
├── agents/             # AutoGen 智能体定义
│   ├── manager.py      # 核心编排器 (Pipeline)
│   ├── planner_agent.py# 行程规划专家
│   ├── writer_agent.py # 深度内容作家
│   ├── figure_agent.py # 可视化专家
│   └── budget_agent.py # 财务专家
├── services/           # 外部服务接口
│   ├── neo4j_service.py    # 图谱操作 (CRUD)
│   ├── mcp_client.py       # 小红书数据采集
│   └── deepsearch_client.py# 全网搜索
├── utils/
│   └── prompts.py      # 提示词工程 (Centralized Prompts)
└── app.py              # Streamlit 前端入口
```

---

## 📌 项目说明

这个项目是一个非常见的测试，但可扩展性很强。因为个人原因，目前只构建了大概的框架，保留了清晰、可替换的组件边界，便于后续继续迭代。

可扩展的方向包括：
*   **智能体可扩展**：现有规划、写作、预算、可视化等智能体都可以继续拆分/新增，覆盖更细的子任务。
*   **模式可扩展**：目前的预设模式只是起点，后续可以按人群、预算、节奏、偏好等维度扩展为更多模式组合。
*   **Ontology 可扩展**：当前 ontology 定义偏基础，可根据具体任务需求更全面地扩充实体/关系，并调整抽取策略与图谱结构设计。

另外，关于最终的路线图目前并未成功生成；如果接入谷歌/高德等地图 MCP，以及更强的图像或可视化能力（如 nanobanana pro），该功能具备完整实现的可能性。

这个项目与市面同类项目最大的不同点在于：从底层构建、框架透明，并以科研的严谨思想组织整体流程与模块边界。

## 📝 开发日志

*   **v1.0.0**: 初始版本，支持基础规划。
*   **v1.1.0**: 引入 Neo4j 知识图谱，解决幻觉问题。
*   **v1.2.0**: 增加 Writer Agent，支持生成 2000字+ 深度指南。
*   **v1.3.0**: 优化可视化，切换为 Graphviz 渲染；集成 DuckDuckGo 真实搜索。

---

Generated by **Trae AI** 🚀

## ⚠️ 声明

此案例用于商业用途需要联系作者。所有内容均基于个人科研积累与兴趣开发，如有借鉴请进行引用。
